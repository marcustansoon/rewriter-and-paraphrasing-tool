<!DOCTYPE html>
<html lang="en-US">
	<head>
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="icon" type="image/x-icon" href="favicon.ico">
	</head>
	<body>
		<div id="iframe-parent" style="opacity: 0; position: absolute;"></div>
		<h3>Paraphrase:-</h3>
		<textarea id='textarea' rows="12" cols="80%"></textarea>
		<h3>Result:-</h3>
		<textarea id='result' rows="12" cols="80%"></textarea>
		<button onclick="paraphrase()" id="button">Go</button>
		<script>
			let elem = document.getElementById('iframe-parent'),
			    result = document.getElementById('result');

			function prepareFrame(src, parentElement) {
				let ifrm = document.createElement("iframe");
				ifrm.setAttribute("src", src);
				ifrm.style.width = "200px";
				ifrm.style.height = "200px";
				parentElement.appendChild(ifrm);
				return ifrm;
			}
			
			function destroyFrame() {
				elem.innerHTML = '';
			}
			
			let languages = ['ms', 'sn', 'mi', 'ro', 'ny', 'de', 'pl', 'fi', 'is', 'la', 'jw', 'ht', 'fr', 'eo', 'eu'],
			languagesOTG;

			function shuffleArray(array) {
				let newArr = array.slice();
				for (let i = newArr.length - 1; i > 0; i--) {
					const rand = Math.floor(Math.random() * (i + 1));
					[newArr[i], newArr[rand]] = [newArr[rand], newArr[i]];
				}
				return newArr;
			}

			function paraphrase() {
				if (document.getElementById('textarea').value.split(" ").length < 15) {
					alert("Must contains at least 15 words yo!");
					return;
				} else if (document.getElementById('textarea').value.split(" ").length >= 400) {
					alert("Too many words yo!");
					return;
				}
				document.getElementById('button').disabled = true;
				// Clone and shuffle array
				languagesOTG = shuffleArray(languages).slice((((Math.random() * 3) + 3) << 0) * -1);
				// Insert 'en' language at first and last index
				languagesOTG.unshift('en');
				languagesOTG.push('en');
				// Start translation
				startTranslation();
			}

			function startTranslation() {
				let ifrm = prepareFrame('google-translate-embed-v2.html', elem);
				
				// Iframe onload handler
				ifrm.addEventListener('load', function() {
					ifrm.contentWindow.postMessage({
						'languages': languagesOTG,
						'sourceText': document.getElementById('textarea').value
					}, '*');
				}, true);
			}
			
			window.onmessage = function(e) {
				if (typeof e.data !== 'object') return;
				if (e.data.type === 'ready'){
					// console.log('ready');
				} else if (e.data.type === 'success') {
					result.value = e.data.result;
					document.getElementById('button').disabled = false;
				}
				console.log(e.data);
			};
		</script>
	</body>
</html>
